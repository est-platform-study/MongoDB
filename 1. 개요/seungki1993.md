### 개요

- MongoDB는 웹 애플리케이션과 인터넷 기반을 위해 설계된 데이터 베이스
  - 데이터 모델과 지속성 전략은 높은 읽기 / 쓰기 효율과 장애조치를 통한 확장의 용이
  - 관계형 데이터 베이스와 다르게 Document 형식으로 저장
    - Document는 key와 value를 가진 데이터의 집합이라고 볼 수 있다.
  - 관계형 데이터 베이스와 다르게 복잡한 연산이 필요하지 않다 .
    - 예를 들면 유저의 모든 정보를 가져오기 위해서는 관계형 데이터 베이스는 때로 조인이 필요로 하다.
    - MongoDB는 document 방식의 저장 store 이기 때문에 하나의 Document로 유정의 모든 정보를 표현 할 수 있다.
  - 매퍼의 복잡성이 사라진다.
    - 관계형 데이터 베이스에서는 객체를 저장하기 위해서 각 컬럼의 객체의 속성을 매핑 시켜서 저장하고 가져오는 반면에 MongoDB는 객체를 그 대로 저장한다. 



- MongoDB는 BSON의 형태로 Document를 저장한다.
  - BSON은 JSON문서를 바이너리로 인코딩한 포맷이다.
  - 최대 사이즈는 16 megabytes



- BSON형식의 Document는 collection에 저장된다.
  - 쉽게 생각하면 Collection은 관계형 데이터 베이스의 테이블과 유사하다
  - MongoDB는 스키마가 없기 때문에 하나의 콜랙션에 들어있는 document의 형식은 다 다를 수 있다.
    - But 보통은 컬랙션 내에 Docuemt는 상대적으로 동일한 구조를 갖도록 한다.



- 스키마 없는 모델의 장점
  - 데이터 베이스가 아닌 애플리케이션이 데이터 구조를 정한다는 것이다.
    - 데이터 베이스에 경우 먼저 스키마를 정의하고 애플리케이션에서 스키마에 맞게 데이터를 형식을 맞추는 반면 스키마 없는 모델은 애플리케이션에 데이터가 그대로 DB에 저장이 되기 때문에 애플리 케이션이 데이터 구조를 정한다고 이야기 한다.
  - 가변 적인 속성을 갖는 데이터를 표현 할 수 있다.



- MongoDB에서도 index를 지원한다.
  - 인덱스의 자료 구조는 B tree로 되어 있다.
  - 관계형 데이터 베이스 처럼 primary key index 부터 secondary index 까지 지원한다.
  - 한 컬렉션에 64개 까지 secondary index를 만들 수 있다.



- MongoDB는 복제 세트라고 부르는 구성을 통해 복제(replica)를 지원한다.
  - 복제 세트는 많은 MongoDB서버로 구성되어 있다.
    - MongoDB서버는 각각의 서버에 존재하며 이를 노드라고한다.
    - elasticsearch의 노드와 유사한 개념
  - 복제세트는 하나의 프라이머리  + 하나 또는 그 이상의 세컨더리가 존재
  - 마스터 슬레이브 구조와 유사
    - 프라이머리는 읽기 / 쓰기 모두가능
    - 세컨더리는 읽기만 가능
  - 복제세트는 장애조치를 자동으로 지원한다.
    - 프라이머리가 고장나면 세컨더리 중 하나를 프라이머리로 만들어버린다.
    - 그 후 프라이머리가 복구가 되면 프라이머리는 세컨더리로 변해 수행한다.



- MongoDB 속도와 내구성
  - 속도는 쓰기 속도를 의미
  - 내구성은 쓰기 연산이 디시크에 제대로 반영이 되었는지
  - 해당 책에서는 최고의 속도와 최고의 내구성은 같이가겨져 갈 수 없으니 포기 할것은 과감하게 포기해야한다.
  - 즉 속도와 내구성 사의의 타협이 필요한데 MongoDB는 저널링, 쓰기 시맨티스로 한다.
    - 저널링 
      - 서버에 이상 상황이 발생할 것을 대비하여 저널 파일을 만들어서 무결성을 확보하는 것
      -  elasticsearch 트랜스 로그라고 생각하면 된다.



- 확장
  - 수직 확장 수평확장
    - 수직 확장은 서버 업그레이드
    - 수평 확장은 여러대 서버에 mongodb 서버를 분산하는것
  - 몽고디비는 수평확장의 용이하다
    - 샤딩을 통해 여러노드에 데잍를 분산하는 것을 자동으로 관리 해준다
    - 샤딩에는 hash , tag 기반 샤딩(3.4버전에서 tag가 zone으로 바뀜)
  - 샤드 복제 세트로 이루어져 있다.











